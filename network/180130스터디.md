# 2018년 1월 30일 스터디 내용정리

## OSI 참조 모델과 TCP/IP의 차이점은 무엇인가?

둘의 차이를 말해보자면, OSI 모델은 전 세계적인 인터네트워크에서 사용할 널리 인정받은 프로토콜 슈트의 기반을 마련하기 위한 것이었다.  
TCP/IP는 OSI의 목적과는 다소 엇나가서 만들어진 프로토콜 슈트였다.   
다만, OSI 참조모델과 인터넷 & TCP/IP 프로토콜 슈트는 서로 경쟁하여 TCP/IP가 승리하고 패권을 잡았다.  
하지만 OSI 참조 모델도 교육적인 유용성 덕분에 지금까지 살아남아 사용되고 있다.  
여기에 더해, 만약 TCP/IP는 OSI를 구현한 것이라고 말한다면, 이는 완전하게 틀린 것이다. 둘은 완벽하게 다른 프로토콜 슈트를 말한다.  
가장 큰 차이점은 하위 프로토콜에 무관하다는 특성이다.  


## 인접(Adjacent), 연결(link, connect), 부속등 여러가지 단어의 뜻

먼저 부속하다, 딸리다 라는 말들의 뜻을 알아보자.  

* 부속: 주된 사물이나 기관에 딸려서 붙음, 또는 그렇게 딸려 붙은 사물
* 딸리다: 어떤 것에 매이거나 붙어 있다.

그리고 다음 3가지 영어 단어에 대해서도 알아보자.

* Connection(연결): when two or more things are joined together or when something is joined to a larger system or network
* Link(연결): Make Connection -> to make a connection between two or more things or people
* Adjacent(인접): 
	* a: not distant, nearby
	* b: having a common denpoint or border
	* c: immediately preceding or following

그리고 네트워크에서 한정적으로 쓰이는, 한글로 된 뜻풀이도 살펴보자.

* 연결(Linked): 노드 사이에 경로(Path)가 있다.
* 인접(Adjacent): 두 노드가 링크로 직접 연결되어 있다.  

이제 이 두가지 뜻을 구별할 수 있다면 다음 뜻도 정확하게 잘 구별할 수 있다.  

* 직접 연결(전달): 네트워크 인터페이스가 **인접**한 것
* 간접 연결(전달): 네트워크 인터페이스가 **연결**된 것


## IP에 대한 여러가지 사실들


* IP는 간접 전달을 맡고 있다. _그리고 설사 인접해 있더라도 IP는 동작한다는 점을 기억하자._  

네트워크 인터페이스: 서로 다른 네트워크 사이의 접점(인터페이스/경계면)  
그렇기 때문에 만약 라우터가 세 개의 네트워크 인터페이스를 가진다면, 라우터는 3개의 IP를 갖는다.  
즉, 하나의 네트워크 인터페이스는 하나의 IP를 할당받는다.  

* IP 주소는 다음과 같이 여러 기능을 가진다.  
	* 네트워크 인터페이스 식별: IP는 하나하나의 기기마다 할당되는 것이 아니라 네트워크 인터페이스 하나하나마다 할당되는 것이다.
	* 라우팅
	* IP주소는 인터네트워크에서 네트워크 계층 데이터 전달에 쓰인다.
	* _IP주소에는 네트워크ID가 포함되어 있기 때문에 IP주소는 네트워크에 종속적이다._

* 라우팅: 서로 다른 인터네트워크 사이에서의 IP데이터그램 간접전달 또는 전달 과정을 통칭하는 개념/말이다.  

* ...호스트를 다중 인터페이스 구성으로 만드는 방법에는 두 가지가 있다.  
	* 두 개 이상의 인터페이스를 동일한 네트워크에 연결.
	* 두 개 이상의 서로 다른 네트워크에 인터페이스를 연결.

클래스 D와 클래스 E는 네트워크 ID 비트수와 호스트 ID 비트수가 정해져 있지 않다.  
거꾸로 말하면 클래스 A, B, C는 미리 정해져 있다고 보면 되겠다. 여기서는 이것 외에도 다른 정보도 몇 가지 알아보겠다.  


## IPv4 주소지정 방법 이모저모

* classful 주소지정 방법의 장점
	* 단순성과 명확성: ...클래스 단위 IP 주소지정 방법에서 IP주소의 클래스는 주소의 처음 4비트를 통해 식별할 수 있다. 이는 classful 주소 지정방법에서 단순성에 해당한다.  
	* 타당한 유연성
	* 라우팅 용이성
	* 예약 주소

주의: 그리고 클래스 A에서 사용 가능한 네트워크ID의 수도 2^7보다 2만큼 작다는 사실에 주목하자.
그 이유는 두 개의 클래스 A 네트워크 ID(0: "this를 뜻함"과 127:"루프백을 뜻함")가 예약되어 있기 때문이다.  


루프백: 루프를 돌아서 돌아온다고 생각하면 된다.(어떻게든 다시 나한테 돌아온다.)  
본질적으로 이것은 일반 프로토콜 스택을 단락(쇼트)시키는 것이다. 즉 장비의 3계층 IP구현은 자신이 전송한 데이터를 즉시 받게 된다.  


그냥 IPv4 주소 지정에서는 IPv4주소는 네트워크 ID와 호스트 ID로 나뉜다.  
그리고 클래스 기반으로 서브네팅을 사용한 주소 지정은 호스트 ID가 서브넷 ID와 호스트 ID 두 가지로 다시 나뉜다.  

* 서브넷의 식별자는 서브넷 ID이다. 서브넷 주소는 전체 네트워크 주소의 서브넷 비트를 서브넷 ID를 대체하여 얻을 수 있다.

* CIDR(Classless Inter-Domain Routing):
	* CIDR은 10년이 넘은 기술이기 때문에 지원에 있어서 어떤 문제가 발생할 가능성이 낮다.
	* CIDR은 그림으로 확실하게 이해하는 것도 좋지만, 개념적으로 이해하고 있으면 된다.
	* Classful 주소지정 방법이나, 서브네팅을 하는 방법을 사용하는 것과 좀 다른 주소지정 방법을 사용한다고 생각하면 된다. 그리고 더 복잡하다.(더 나중에 나온 주소지정 방법이 대체로 더 복잡하다.)

* VLSM(Variable Length Subnet Masking): 
	* 가변 길이 서브넷 마스킹은 서브네팅을 여러 번 반복하여 네트워크를 크기가 다른 여러 서브 네트워크 계층으로 구분하는 기법이다.
	* 일반적인 서브넷 마스킹이 한 번만 서브넷으로 나눈다고 생각하면, VLSM은 원하는 만큼 서브넷을 계속 나누는 것을 뜻한다.

* VLSM VS CIDR
	* VLSM: VLSM은 사설 기관의 단일 네트워크에서의 서브넷을 다룬다.
	* CIDR은 네트워크 주소 할당 방법을 변경하고, 단일 클래스 계층 구조를 다중 계층 구조로 대체함으로써 VLSM의 개념을 인터넷 전체로 확장했다.  

* 서브네팅: 서브네팅 체계의 주요 약점은 세밀성이 떨어진다는 것이다.  

* 슈퍼네팅: 슈퍼네팅은 서브네팅의 원리를 대형 네트워킹에 적용했다.  

## 데이터 표현 용어에 대한 이모저모

* IP 데이터그램은 때로 IP패킷이라고 불린다.(하지만 데이터그램이 보다 여러 계층을 포괄하는 말로 들린다.)
* 2계층에서만 푸터를 사용하는데, 이 푸터는 앞에 있는 것을 다 확인해야만 붙일 수 있기 때문에, 푸터를 2계층에서만 뒤에 붙이는 것이라고 생각하면 된다. 나머지 계층은 헤더로 다 처리할 수 있다.  
* Payload는 N+1계층이 N계층에서 받는 SDU라고 생각하면 이 용어는 적합하다. 이 용어의 기원은 우주과학에서 "유효 적재량"이라는 뜻에서 따왔다.


## 헤더 안에 들어가는 데이터 포맷

### IPv4 헤더에서 워드 크기에 대한 주의사항

| 이름                        | 설명    |
|-----------------------------|---------|
|  IHL에서의 워드크기         | 4바이트 |
| 헤더 체크섬에서의 워드 크기 | 2바이트 |

### IPv4의 플래그

| 이름              | 설명(참고: 모두 1비트임)              |
|-------------------|---------------------------------------|
| DF(Dont Fragment) | 1: 단편화 하지 말 것   0: 단편화 해라 |
| MF(More Fragment) | 1: 끝이 아님   0: 마지막              |
| 예약 플래그       | 안쓰임                                |

## IP 데이터그램 크기, MTU, 단편화 개요

* 네트워크 계층 하부에서는 **데이터가 항상 하나 이상의 물리 네트워크를 거쳐가야 한다는 사실을 기억해야 한다.**  

* MTU를 한 문장으로 정의하면:
	* IP 인터네트워크의 각 장비는 자신이 다른 장비와 맺는 데이터 링크 계층 연결의 용량을 알아야 한다.
	* 여기서 용량은 비트, 바이트, 니블과 같은 데이터 표현방식이나 PDU단위(패킷, 데이터그램, 세그먼트, 셀 등등)을 말한다.
	* 이 용량은 네트워크의 최대 전송 단위(MTU: Maximum Transmission Unit)라고 한다. 보통 1,500바이트이며, 최소 576바이트는 되어야 한다.

* **중요!: 중간 경로에서 단편화는 일어나도 재조합은 일어나지 않는다.**
* MTU 경로 발견을 통해 전체 경로의 MTU를 파악할 수 있다.  


## IP 메시지 단편화 과정

단편화 과정에서는 헤더의 개수만큼 전체 메시지 크기는 증가한다.  

* n은 단편화 과정에서 만들어진 최종 헤더의 개수다.
* 전체 메시지의 크기는 (n - 1)\*(header\_size)
* 증분(delta)과 n배수(times)에 대한 차이를 이해하면 좋다.

## 단편화 관련 IP데이터그램 헤더 필드

| 이름          | 설명                                                                                                                                                                                                        |
|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 전체 길이     | 단편화가 일어난 뒤, Total Length필드는 원본 메시지의 전체 길이가 아닌 각 단편의 길이를 나타낸다.                                                                                                            |
| 식별자        | 이 값은 각 단편의 IP헤더의 식별자 필드에 저장된다.  식별자 필드는 16비트이기 때문에 65,536게의 서로 다른 식별자가 쓰일 수 있다. 분명히, 단편화 되는 각 메시지가 서로 다른 식별자를 갖도록 하고 싶을 것이다. |
| MF            | MF플래그는 맨 마지막 단편만 0으로, 나머지는 1로 설정된다.  MF가 0으로 설정된 단편을 받는 목적지 장비는 메시지의 맨 마지막 단편을 받았다고 간주한다.                                                         |
| 단편화 오프셋 | 단편화 오프셋 필드는 전체 메시지에서 각 단편이 어디에 위치해야 하는지를 알려줌으로써 단편의 순서 지정 문제를 해결한다.                                                                                      |

## IP 메시지 재조합

* 데이터그램은 단편화될 경우 여러 조각으로 나뉜다. 전체 메시지의 최종 목적지 장비는 이들 단편을 모아서 원본 메시지로 재조합 해야한다.  


* 세부적인 재조합 과정을 각 장비마다 다르지만 일반적으로 다음 기능을 포함한다.
	* 단편 인식과 단편화된 메시지 식별: 수신 장비는 MF(More Fragment) 비트가 1로 설정됐거나 단편화 오프셋이 0이 아닌 데이터그램을 보고 단편을 받았다는 것을 인식한다.  
	  그리고 출발지와 목적지 IP 주소, 헤더에 명시된 프로토콜, 식별자 필드를 통해 메시지를 식별한다.  
	* 버퍼 초기화: 수신 장비는 단편을 받아서 저장할 버퍼를 초기화한다. 이때 특수 테이블 등을 사용하여 버퍼의 어떤 부분이 수신한 단편으로 채워졌는지를 기록한다.  
	  이를 통하여 수신 장비는 버퍼의 일부만이 단편으로 채워졌는지, 아니면 모두 채워졌는지를 파악할 수 있다.  
	* 타이머 초기화: 수신 장비는 메시지 재조합을 위한 타이머를 설정한다. 일부 단편을 영원히 수신하지 못할 수도 있기 때문에,  
	  이 타이머는 수신 장비가 메시지를 재조합하기 위해 무한히 기다리는 것을 방지할 수 있다.(TTL과는 좀 달라보인다.)
	* 단편 수신과 처리: 메시지의 단편이 도착할 때마다(첫 단편과 동일한 출발지와 목적지 주소, 프로토콜, 식별자 필드를 갖는 것으로 구분함), 수신 장비는 그것을 처리한다.  
	  수신 장비는 메시지 버퍼의 단편화 오프셋 위치에 그 단편을 삽입한다. 그리고 그 부분의 데이터를 받았다는 것을 테이블에 표시해 둔다.  

## 통신, 파일 그리고 메시지

* 파일:
	* 컴퓨터가 다루는 정보(Information: not data)의 기본 단위다. 컴퓨터 파일의 구현은 비트 스트림으로 이루어진다.  
	* 주의점: 중요한 것은 파일이라는 것이 임의의 정보는 포함하는 객체라는 사실이다.

* 메시지:
	* 통신을 위해 만들어진 파일을 메시지라고 부른다.

* 통신:
	* 통신의 가장 기본은 파일과 메시지를 전송하는 것이다.  


## TTL과 타이머의 차이점

* TTL: TTL 값이 0이 되면 패킷이 버려진다.
* 타이머: 타이머 값이 0이면 수신 장비가 패킷을 포기한다.

즉, 둘은 완전히 다른 개념이다.  

F
## NAT 네트워크 주소 변환 프로토콜

CIDR은 기껏해야 IPv4 주소 공간 고갈 속도를 조금 늦추게 하는 정도의 역할밖에 수행하지 못했다.  
IPv6는 개발하는 데 상당한 시간이 걸렸고 실제로 적용되려면 많은 시간이 걸릴 것으로 예상된다.

* IETF(Internet Engneering Task Force)가 NAT를 개발했다.  

NAT은 다소 조잡한 해결책(Kludge)이지만, IPv4의 수명을 획기적으로 늘리는 데 성공했다.


### IP NAT의 장점

* 공인 IP주소 공유: 보안 향상, 주소 고갈 문제 해결
* 쉬운 확장
* 로컬 통제력 강화
* 인터넷 서비스 제공자 선택의 유연성
* 보안 강화
* 투명함(대부분)

### IP NAT의 단점

* 복잡성
* 공인 주소 부족으로 인한 문제
* 특정 애플리케이션과의 호환성
* 보안 프로토콜 문제
* 클라이언트 접근 지원 미비
* 성능 감소

## NAT 주소 용어

* 내부 주소 - 사설 주소: ... 그래서 로컬 네트워크의 장비를 가리키는 모든 주소를 내부주소(inside/private address)라고 부른다.
* 외부 주소 - 공인 주소: ... 공중 인터넷에 있는 장비를 가리키는 주소를 외부 주소(outside/public address)라고 부른다.

## 다음 시간까지

* II-8부 전부
* 70장, 71장
* 28장도 공부해서 오자.
